function privatesquare_trips_datepicker_init(){var a=$("#arrival").datepicker({language:"en"}).on("changeDate",function(c){c=new Date(c.date);c.setDate(c.getDate()+1);b.date.valueOf()<=c.valueOf()&&b.setValue(c);a.hide();$("#departure")[0].focus()}).data("datepicker"),b=$("#departure").datepicker({language:"en",onRender:function(c){return c.valueOf()<=a.date.valueOf()?"disabled":""}}).on("changeDate",function(){b.hide()}).data("datepicker")}
function privatesquare_trips_select2_init(){var a=privatesquare_abs_root_url()+"user_trips_add_geocode.php";$("#where").select2({minimumInputLength:3,ajax:{url:a,dataType:"json",data:function(b){return{q:b}},results:function(b){return{results:b.results}}}})}
function privatesquare_trips_gather_trip_info(){var a=$("#where").val(),b=$("#arrival").val(),c=$("#departure").val(),d=$("#arrive_by").val(),e=$("#depart_by").val(),f=$("#status_id").val(),g=$("#note").val();a={woeid:a,arrival:b,departure:c,arrive_by:d,depart_by:e,status_id:f,note:g};if(trip=$("#trip"))a.id=trip.val();return a}
function privatesquare_trips_add_init(){privatesquare_trips_datepicker_init();privatesquare_trips_select2_init();$("#add-trip").submit(function(){var a=$("#add-trip").attr("data-add-trip-crumb"),b=privatesquare_trips_gather_trip_info();b.crumb=a;a=$("#select2-chosen-1").html();$("#add-trip").attr("disabled","disabled");privatesquare_api_call("privatesquare.trips.addTrip",b,_privatesquare_trips_add_trip_onsuccess);privatesquare_set_status("Adding trip to "+htmlspecialchars(a));return false})}
function _privatesquare_trips_add_trip_onsuccess(a){if(a.stat!="ok"){privatesquare_set_status(a.error.error,"danger");$("#add-trip").removeAttr("disabled");return false}location.href=a.trip.trip_url+"?success=1"}
function privatesquare_trips_edit_init(){privatesquare_trips_datepicker_init();$("#change-city").click(function(){$(this).hide();privatesquare_trips_select2_init();$("#where").select2("open");return false});$("#edit-trip").submit(function(){$("#where").select2("close");var a=$("#edit-trip").attr("data-edit-trip-crumb"),b=privatesquare_trips_gather_trip_info();b.crumb=a;privatesquare_api_call("privatesquare.trips.editTrip",b,_privatesquare_trips_edit_trip_onsuccess);privatesquare_set_status("Updating your trip");
return false});$("#delete-trip").click(function(){if(!confirm("Are you sure you want to delete this trip?"))return false;var a=$("#edit-trip").attr("data-delete-trip-crumb");a={id:$("#trip").val(),crumb:a};privatesquare_api_call("privatesquare.trips.deleteTrip",a,_privatesquare_trips_delete_trip_onsuccess);privatesquare_set_status("Deleting your trip");return false})}
function _privatesquare_trips_edit_trip_onsuccess(a){if(a.stat!="ok"){privatesquare_set_status(a.error.error,"danger");return false}a=a.trip;var b=$("#short-name");b.html(a.locality.woe_name);b.attr("href",a.place_url);$("#long-name").html(a.locality.name);$("#where").select2("destroy");$("#change-city").show();privatesquare_set_status("Your trip has been updated!")}
function _privatesquare_trips_delete_trip_onsuccess(a){if(a.stat!="ok"){privatesquare_set_status(a.error.error,"danger");return false}a=privatesquare_abs_root_url()+"me/trips/?deleted=1";location.href=a};
